<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <script type="application/javascript">

        // https://stackoverflow.com/a/18053642/2801663
        function getCursorPosition(canvas, event) {
            var rect = canvas.getBoundingClientRect();
            var x = event.clientX - rect.left;
            var y = event.clientY - rect.top;
            return [x, y];
        }

        function addClickHandler() {
            var canvas = document.getElementById('canvas');
            var rect = canvas.getBoundingClientRect();

            canvas.addEventListener("mousedown", function (e) {
//                alert("touch is ok. but is it standard-compliant? ( ﾟ∀。)");
                var x, y;
                [x, y] = getCursorPosition(canvas, e);
                console.log(x, y, e.clientX, e.clientY, rect.left, rect.top)
                console.log(canvas.width, canvas.height, canvas.scrollWidth, canvas.scrollHeight)


                var rid = Math.floor(Math.random() * 8);
                var rcolor = Math.floor(Math.random() * 3) ;
                gameStatus[rid] = rcolor;
                drawAccordingToStatus();
            });
        }

        /**
         * 拓扑与坐标无关……
         * */
        var adj0 = {
            0: [1, 3],
            1: [0, 2, 3, 4],
            2: [1, 4],
            3: [0, 1, 5, 6],
            4: [1, 2, 6, 7],
            5: [3, 6],
            6: [3, 4, 5, 7],
            7: [4, 6]
        };

        /**
         * 游戏状态又与棋盘形状无关……
         */
        var positionedNodes = {
            0: {x: 250, y: 250},
            1: {x: 500, y: 250},
            2: {x: 750, y: 250},
            3: {x: 250, y: 500},
            4: {x: 750, y: 500},
            5: {x: 250, y: 750},
            6: {x: 500, y: 750},
            7: {x: 750, y: 750}
        };

        var gameStatus = {
            0: 0,
            1: 1,
            2: 2,
            3: 2,
            4: 1,
            5: 0,
            6: 2,
            7: 0
        };

        /**
         * 结点画个小黑圆点；
         * 只从小 id 向大 id 画线，避免画两遍；
         */
        function drawBoard(ctx) {
            for (id1 in positionedNodes) {
                var x1 = positionedNodes[id1].x,
                    y1 = positionedNodes[id1].y;
                drawLittleBlack(x1, y1);
                ;
                for (j in adj0[id1]) {
                    id2 = adj0[id1][j];
                    if (id1 <= id2) {
                        var x2 = positionedNodes[id2].x,
                            y2 = positionedNodes[id2].y;
                        drawLine(x1, y1, x2, y2);
                    }
                }
            }


            /**
             * 嵌套定义 function 提升出去什么的……看看 TODO
             */
            function drawLine(x1, y1, x2, y2) {
                ctx.fillStyle = "black";
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke(); // 最后一起 stroke 以提升性能？……
            }

            function drawLittleBlack(x, y) {
                ctx.fillStyle = "black";
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawAccordingToStatus() {
            var canvas = document.getElementById('canvas');
            if (canvas.getContext) {
                var ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBoard(ctx);
                for (id in gameStatus) {
                    if (gameStatus[id] !== 0) {
                        var x = positionedNodes[id].x,
                            y = positionedNodes[id].y,
                            colorNum = gameStatus[id];
                        drawStone(x, y, colorNum);
                    }
                }
            }

            /**
             * @param colorEnum 1 black, 2 white 无防御
             */
            function drawStone(x, y, colorEnum) {
                ctx.fillStyle = colorEnum === 1 ? "black" : "white";
                ctx.beginPath();
                ctx.arc(x, y, 25, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = "black";
                ctx.arc(x, y, 25, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

    </script>

    <style>
        #canvas {
            width: 100%;
            height: 100%;

            /* 现实烦恼来得快：解决 iOS 浏览器事件绑定区域点击闪屏问题 */
            -webkit-tap-highlight-color: transparent;
        }

        #restart {

        }
    </style>

</head>
<body onload="(function(){drawAccordingToStatus();addClickHandler()})()">
<!--妙啊，html 里 width height 规定画布大小，css 里 width height 规定缩放。这符合标准吗？-->
<canvas id="canvas" width="1000" height="1000"></canvas>

<button id="restart">重新开始</button>
<p>下一手：<span id="next">黑</span>棋</p>
</body>
</html>